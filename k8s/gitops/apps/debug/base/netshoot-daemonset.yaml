apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: netshoot
  namespace: debug
spec:
  selector:
    matchLabels: { app: netshoot }
  template:
    metadata:
      labels: { app: netshoot }
    spec:
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
      tolerations:
        - key: node-role.kubernetes.io/master
          effect: NoSchedule
        - key: node-role.kubernetes.io/control-plane
          effect: NoSchedule
      containers:
        - name: netshoot
          image: nicolaka/netshoot:latest@sha256:7f08c4aff13ff61a35d30e30c5c1ea8396eac6ab4ce19fd02d5a4b3b5d0d09a2
          command: ['bash', '-lc', 'sleep infinity']
          securityContext:
            privileged: true
      restartPolicy: Always
  updateStrategy: { type: RollingUpdate }
